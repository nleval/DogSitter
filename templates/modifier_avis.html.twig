{% extends 'base_template.twig' %}

{% block title %}
    Modifier l'avis — DogSitter
{% endblock %}

{% block content %}
    <div class="container-fluid" style="background-color:#FEFAE0; min-height:100vh;">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8">
                    <h2 class="text-center mb-5 fw-bold" style="color:#537031; font-family:'Poppins', sans-serif;">
                        Modifier l'avis
                    </h2>

                    <div class="card shadow-lg" style="border:none; border-radius:12px; overflow:hidden;">
                        <div style="background-color:#FAF6E9; padding:32px; border-left:6px solid #DDA15E;">
                            <form method="post">
                                <div class="mb-4">
                                    <label for="note" class="form-label fw-bold" style="color:#537031;" title="Choisissez une note de 1 à 5">
                                        Note <span class="required-star" aria-hidden="true" title="Champ requis">★</span>
                                    </label>
                                    {% if erreurs is defined and erreurs %}
                                        {% for err in erreurs %}
                                            {% if 'note' in err|lower %}
                                                <div style="color:#dc3545; font-size:13px; margin-bottom:8px;">{{ err }}</div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    <div class="rating" data-value="3" title="Choisissez une note de 1 à 5">
                                        <img src="images/Nonos2.svg"  data-star="1" alt="1 étoile">
                                        <img src="images/Nonos2.svg"  data-star="2" alt="2 étoiles">
                                        <img src="images/Nonos2.svg"  data-star="3" alt="3 étoiles">
                                        <img src="images/Nonos.svg" data-star="4" alt="4 étoiles">
                                        <img src="images/Nonos.svg" data-star="5" alt="5 étoiles">
                                    </div>
                                    <input type="hidden" name="note" id="note" value="{{ donnees.note|default('3') }}">
                                </div>

                                <style>
                                .rating {
                                    display: flex;
                                    gap: 6px;
                                    cursor: pointer;
                                }

                                .rating img {
                                    width: 50px;
                                    height: 50px;
                                }
                                </style>

                                <script>
                                const stars = document.querySelectorAll('.rating img');
                                const input = document.getElementById('note');

                                stars.forEach(star => {
                                    star.addEventListener('click', () => {
                                        const value = star.dataset.star;
                                        input.value = value;

                                        stars.forEach(s => {
                                            s.src = s.dataset.star <= value
                                                ? 'images/Nonos2.svg'
                                                : 'images/Nonos.svg';
                                        });
                                    });
                                });
                                </script>

                                <div class="mb-4">
                                    <label for="description" class="form-label fw-bold" style="color:#537031;">
                                        Commentaire
                                    </label>
                                    {% if erreurs is defined and erreurs %}
                                        {% for err in erreurs %}
                                            {% if 'texte_commentaire' in err|lower or 'commentaire' in err|lower %}
                                                <div style="color:#dc3545; font-size:13px; margin-bottom:8px;">{{ err }}</div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    <textarea class="form-control"
                                        id="texte_commentaire"
                                        name="texte_commentaire"
                                        rows="4"
                                        maxlength="500"
                                        title="Commentaire optionnel (maximum 500 caractères)"
                                        placeholder="Donnez votre avis sur cette promenade"
                                        style="border:1px solid #DDA15E; background-color:#FEFAE0; color:#537031; border-radius:8px; resize: vertical;">{{ donnees.texte_commentaire|default('')|trim }}</textarea>
                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <a href="index.php"
                                        class="btn btn-outline"
                                        title="Annuler les modifications et revenir en arrière"
                                        style="border-radius:8px; border-color: #537031; color: #537031;">
                                        Annuler
                                    </a>
                                    <button type="submit"
                                        class="btn fw-bold text-white"
                                        title="Enregistrer les modifications de l'avis"
                                        style="background-color:#BC6C25; border-radius:8px; padding:10px 28px;">
                                        Modifier l'avis
                                    </button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% extends 'base_template.twig' %}

{% block title %}{{ title }} — DogSynergie{% endblock %}

{% block content %}
{% if not estPromeneur %}
<div style="background-color: #FEFAE0; min-height: 100vh; padding: 24px;">
    <div style="max-width: 1200px; margin: 0 auto;">
        <div class="alert text-center fw-semibold" style="background-color:#DDA15E; color:#FEFAE0; border:1px solid #BC6C25; border-radius:12px;">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Accès refusé : seuls les promeneurs peuvent voir leurs promenades.
        </div>
    </div>
</div>
{% else %}
<div style="background-color: #FEFAE0; min-height: 100vh; padding: 0; display: flex; flex-direction: column;">
    <div style="flex: 1; padding: 0 24px 24px 24px; max-width: 1200px; margin: 0 auto; width: 100%;">
        <div class="ds-profile-hero" style="margin-top:0;">
            <div class="ds-profile-hero-inner">
                <h1 class="ds-profile-hero-title"><i class="bi bi-map me-2"></i>{{ title }}</h1>
                <p class="ds-profile-hero-subtitle">Suivi rapide de vos promenades</p>
            </div>
        </div>

        <div style="background-color: #FAF6E9; padding: 22px; margin-bottom: 32px; border-radius: 12px; border: 1px solid #DDA15E; box-shadow: 0 5px 14px rgba(83, 112, 49, 0.14);">
            <h3 style="display: inline-flex; align-items: center; gap: 8px; font-size: 13px; color: #FEFAE0; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; margin: 0 0 16px 0; padding: 7px 12px; border-radius: 999px; background-color: #537031; border: 1px solid #4a5f28;">
                <i class="bi bi-funnel-fill" style="color: #FEFAE0;"></i>
                Statut
            </h3>
            <div style="display:flex; flex-wrap:wrap; gap:10px;">
                <a href="?controleur=annonce&methode=mesPromenades&statut=a_venir"
                   style="text-decoration:none; font-size:13px; font-weight:700; border-radius:999px; padding:10px 14px; border:1px solid {% if statut == 'a_venir' %}#BC6C25{% else %}#DDA15E{% endif %}; color:{% if statut == 'a_venir' %}#FEFAE0{% else %}#537031{% endif %}; background-color:{% if statut == 'a_venir' %}#DDA15E{% else %}#FEFAE0{% endif %}; transition:all 0.2s;"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(83, 112, 49, 0.20)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i class="bi bi-calendar-check"></i> À venir
                </a>
                <a href="?controleur=annonce&methode=mesPromenades&statut=en_cours"
                   style="text-decoration:none; font-size:13px; font-weight:700; border-radius:999px; padding:10px 14px; border:1px solid {% if statut == 'en_cours' %}#4a5f28{% else %}#DDA15E{% endif %}; color:{% if statut == 'en_cours' %}#FEFAE0{% else %}#537031{% endif %}; background-color:{% if statut == 'en_cours' %}#537031{% else %}#FEFAE0{% endif %}; transition:all 0.2s;"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(83, 112, 49, 0.20)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i class="bi bi-play-circle"></i> En cours
                </a>
                <a href="?controleur=annonce&methode=mesPromenades&statut=archivee"
                   style="text-decoration:none; font-size:13px; font-weight:700; border-radius:999px; padding:10px 14px; border:1px solid {% if statut == 'archivee' %}#9a5316{% else %}#DDA15E{% endif %}; color:{% if statut == 'archivee' %}#FEFAE0{% else %}#537031{% endif %}; background-color:{% if statut == 'archivee' %}#BC6C25{% else %}#FEFAE0{% endif %}; transition:all 0.2s;"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(83, 112, 49, 0.20)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i class="bi bi-archive"></i> Archivées
                </a>
            </div>
        </div>

        {% if promenades|length > 0 %}
            <div style="display: grid; gap: 18px; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));">
                {% for promenade in promenades %}
                    {% set borderColor = '#BC6C25' %}
                    {% set statusLabel = 'Archivée' %}
                    {% set statusIcon = 'bi-archive' %}
                    {% if statut == 'en_cours' %}
                        {% set borderColor = '#537031' %}
                        {% set statusLabel = 'En cours' %}
                        {% set statusIcon = 'bi-play-circle' %}
                    {% elseif statut == 'a_venir' %}
                        {% set borderColor = '#DDA15E' %}
                        {% set statusLabel = 'À venir' %}
                        {% set statusIcon = 'bi-calendar-check' %}
                    {% endif %}

                    <div style="background-color: #FFFFFF; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 14px rgba(83, 112, 49, 0.10); border: 1px solid rgba(221, 161, 94, 0.45); transition: all 0.22s ease; display: flex; flex-direction: column; position: relative;"
                         onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 18px rgba(83, 112, 49, 0.18)'; this.style.borderColor='#DDA15E';"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 14px rgba(83, 112, 49, 0.10)'; this.style.borderColor='rgba(221, 161, 94, 0.45)';">
                        <div style="height: 4px; background-color: {{ borderColor }};"></div>
                        <div style="flex: 1; padding: 20px; display: flex; flex-direction: column;">
                            <div style="display:flex; justify-content:space-between; gap:10px; margin-bottom:8px; align-items:flex-start;">
                                <h3 style="margin: 0; color: #3f5623; font-size: 18px; font-weight: 700; line-height: 1.35; letter-spacing: 0.2px;">
                                    {% if promenade.annonce %}
                                        {{ promenade.annonce.titre }}
                                    {% else %}
                                        Promenade
                                    {% endif %}
                                </h3>
                                <span style="display:inline-flex; align-items:center; gap:6px; font-size:11px; font-weight:700; border-radius:999px; padding:6px 10px; color:#FEFAE0; background-color:{{ borderColor }}; white-space:nowrap;">
                                    <i class="bi {{ statusIcon }}"></i> {{ statusLabel }}
                                </span>
                            </div>

                            <div style="display: flex; gap: 14px; margin: 0 0 14px 0; font-size: 13px; color: #537031; flex-wrap: wrap;">
                                {% if promenade.date_promenade %}
                                    <span style="display: inline-flex; align-items: center; gap: 6px;"><i class="bi bi-calendar-event" style="color: #537031;"></i>{{ promenade.date_promenade|date('d/m/Y H:i') }}</span>
                                {% endif %}
                                {% if promenade.annonce %}
                                    <span style="display: inline-flex; align-items: center; gap: 6px;"><i class="bi bi-geo-alt-fill" style="color: #DDA15E;"></i>{{ promenade.annonce.endroitPromenade }}</span>
                                {% endif %}
                            </div>

                            {% if promenade.annonce and promenade.annonce.description %}
                                <p style="margin: 0 0 14px 0; color: #4F4F4F; font-size: 14px; line-height: 1.6; flex: 1;">
                                    {{ promenade.annonce.description|slice(0, 150) }}{% if promenade.annonce.description|length > 150 %}...{% endif %}
                                </p>
                            {% endif %}

                            <div style="display: flex; gap: 18px; margin-bottom: 16px; padding-top: 10px; border-top: 1px solid rgba(221, 161, 94, 0.45); flex-wrap:wrap;">
                                {% if promenade.annonce %}
                                    <div style="display: flex; flex-direction: column; min-width:90px;">
                                        <span style="font-size: 11px; color: #537031; text-transform: uppercase; letter-spacing: 0.4px; font-weight: 700;">Durée</span>
                                        <span style="font-size: 16px; color: #3f5623; font-weight: 800;">{{ promenade.annonce.duree }} min</span>
                                    </div>
                                    <div style="display: flex; flex-direction: column; min-width:90px;">
                                        <span style="font-size: 11px; color: #BC6C25; text-transform: uppercase; letter-spacing: 0.4px; font-weight: 700;">Tarif</span>
                                        <span style="font-size: 16px; color: #BC6C25; font-weight: 800;">{{ promenade.annonce.tarif }}€</span>
                                    </div>
                                {% endif %}
                                {% if promenade.maitre %}
                                    <div style="display: flex; flex-direction: column; min-width:120px;">
                                        <span style="font-size: 11px; color: #537031; text-transform: uppercase; letter-spacing: 0.4px; font-weight: 700;">Maître</span>
                                        <span style="font-size: 14px; color: #3f5623; font-weight: 700;">{{ promenade.maitre.pseudo }}</span>
                                    </div>
                                {% endif %}
                            </div>

                            <div style="display: flex; gap: 12px;">
                                          <a href="?controleur=annonce&methode=afficherPromenade&id_annonce={{ promenade.id_annonce }}"
                                              style="flex: 1; background-color: #537031; color: #FEFAE0; padding: 12px 16px; font-size: 13px; border: 1px solid #4a5f28; border-radius: 8px; font-weight: 700; text-decoration: none; text-align: center; transition:transform 0.2s, box-shadow 0.2s, background-color 0.2s; box-shadow:0 4px 12px rgba(83, 112, 49, 0.25);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 7px 16px rgba(83, 112, 49, 0.35)'; this.style.backgroundColor='#4a5f28';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(83, 112, 49, 0.25)'; this.style.backgroundColor='#537031';">
                                    <i class="bi bi-eye"></i> Détails
                                </a>
                                {# Suppression du bouton "Terminer" pour les promeneurs, tout est automatique #}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="background-color: #FAF6E9; border-left: 4px solid #DDA15E; padding: 24px; border-radius: 8px; text-align: center;">
                <p style="font-size: 16px; color: #537031; margin: 0; font-weight: 600;">
                    <i class="bi bi-inbox" style="margin-right: 8px; color: #DDA15E;"></i>
                    Vous n'avez pas de promenades {% if statut == 'a_venir' %}à venir{% elseif statut == 'en_cours' %}en cours{% else %}archivées{% endif %}.
                </p>
                     <a href="?controleur=annonce&methode=afficherAllAnnonces"
                         style="display:inline-flex; margin-top:14px; align-items:center; gap:8px; background-color:#537031; color:#FEFAE0; padding:10px 16px; border:1px solid #4a5f28; border-radius:999px; text-decoration:none; font-weight:700; font-size:13px; transition:transform 0.2s, box-shadow 0.2s, background-color 0.2s; box-shadow:0 4px 12px rgba(83, 112, 49, 0.25);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 7px 16px rgba(83, 112, 49, 0.35)'; this.style.backgroundColor='#4a5f28';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(83, 112, 49, 0.25)'; this.style.backgroundColor='#537031';">
                    <i class="bi bi-search"></i> Voir les annonces
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
